<form id="paymentForm">
  <div class="form-group">
    <label for="email">Email Address</label>
    <input type="email" id="email-address" required />
  </div>
  
  <div class="form-group">
    <label for="phone">Phone</label>
    <input type="tel" id="phone" required />
  </div>
  
  <div class="form-submit">
    <button type="submit" onclick="payWithPaystack()"> Pay </button>
  </div>
</form>

<script src="https://js.paystack.co/v1/inline.js"></script> 
<script type="text/javascript" charset="utf-8">
    const paymentForm = document.getElementById('paymentForm');
paymentForm.addEventListener("submit", payWithPaystack, false);

const formattedDate = (moment) => {
    const pad = (n) => n >=10 ? n : "0"+n 
    
    const date = moment || new Date()
    const day = date.getDay()
    const month = date.getMonth()
    const year = date.getFullYear()
    
    return `${year}-${pad(month + 1)}-${pad(day)}`
}

function payWithPaystack(e) {
  e.preventDefault()
  const phone = document.getElementById("phone").value
  const email = document.getElementById("email-address").value
  
  let handler = PaystackPop.setup({
    email,
    phone,
    key: 'pk_test_3baa29676132d0f704cc5a21a3a764d9697fc606', // Replace with your public key
    amount: 500 * 100, //document.getElementById("amount").value * 100,
    ref: `${phone}-${formattedDate()}`,
    onClose: function(){
      alert('Window closed.');
    },
    callback: function(response){
      let message = 'Payment complete! Reference: ' + response.reference;
      
      fetch(`http://localhost:5000/api/payment/verify/${response.reference}`).then(res => res.json()).then(console.log).catch(console.error)
      alert(message);
    }
  });
  
  handler.openIframe();
}
</script>
